---
- name: Create security policies
  hosts: all
  gather_facts: false
  connection: local

  vars:
    device:
      ip_address: "192.168.1.132"
      username: "admin"
      password: "Ahmed123"

  tasks:
    - name: Create first security rule
      paloaltonetworks.panos.panos_security_rule:
        provider: "{{ device }}"
        rule_name: 'permit'
        source_zone: ['any']
        destination_zone: ['any']
        source_ip: ['any']
        destination_ip: ['any']
        application: ['any']
        service: ['application-default']
        action: 'allow'

     - name: Create ethernet interfaces
       paloaltonetworks.panos.panos_interface:
         provider: '{{ provider }}'
         if_name: "{{ item.name }}"
         ip: "{{ item.ip }}"
       with_items:
         - { name: "ethernet1/5", ip: "10.10.10.10" }
         - { name: "ethernet1/6", ip: "10.10.30.30" }

    # - name: enable DHCP client on ethernet1/1.5 in zone public
    #   paloaltonetworks.panos.panos_l3_subinterface:
    #     provider: '{{ device }}'
    #     name: "ethernet1/1.5"
    #     tag: 5
    #     ip: ["10.1.1.1/24"]
    #     zone_name: "trust2"
    - name: create DMZ zone on a firewall
      paloaltonetworks.panos.panos_zone:
        provider: '{{ device }}'
        zone: 'trust2'
        mode: 'layer3'
        
    # - name: add interfaces to zone trust2
    #   paloaltonetworks.panos.panos_interface:
    #     provider: '{{ device }}'
    #     zone: 'trust2'
    #     mode: 'layer3'
    #     interface: ['ethernet1/1', 'ethernet1/1.30', 'ethernet1/1.40']
        
    - name: create DMZ zone on a firewall
      paloaltonetworks.panos.panos_zone:
        provider: '{{ device }}'
        zone: 'untrust2'
        mode: 'layer3'
        
    # - name: add ethernet1/2 to zone untrust2
    #   paloaltonetworks.panos.panos_interface:
    #     provider: '{{ device }}'
    #     zone: 'untrust2'
    #     mode: 'layer3'
    #     interface: ['ethernet1/2']

 
